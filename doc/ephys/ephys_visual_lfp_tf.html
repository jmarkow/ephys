<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ephys_visual_lfp_tf</title>
  <meta name="keywords" content="ephys_visual_lfp_tf">
  <meta name="description" content="ephys_lfp_tf.m takes data generated by ephys_cluster.m and stored in extracted_data.mat">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../menu.html">Home</a> &gt;  <a href="menu.html">ephys</a> &gt; ephys_visual_lfp_tf.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../menu.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="menu.html">Index for ephys&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>ephys_visual_lfp_tf
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>ephys_lfp_tf.m takes data generated by ephys_cluster.m and stored in extracted_data.mat</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [SPECT_AVE]=ephys_visual_lfp_tf(EPHYS_DATA,HISTOGRAM,CHANNELS,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">ephys_lfp_tf.m takes data generated by ephys_cluster.m and stored in extracted_data.mat
and produces song_aligned LFP average spectrogram

    [LFP_RASTER TIME LABEL HISTOGRAM]=ephys_lfp_amp(MIC_DATA,EPHYS_DATA,CHANNELS,varargin)

    EPHYS_DATA
    aligned ephys data generated by ephys_cluster or in extracted_data/aggregated_data.mat
    (should be the variable ephys_data), the data should be a matrix of doubles that is 
    samples x trials x channels

    HISTOGRAM
    contour histogram returned by ephys_visual_histogram.m (or loaded from histogram.mat)

    CHANNELS
    channel labels (i.e. the channel that corresponds to a given element in the cell array
    ephys_data) from ephys_cluster.m or extracted_data/aggregated_data.mat

    the following may be specified as parameter/value pairs:

        car_exclude
        electrodes to exclude from noise estimate

        SR
        data sampling rate (default: 25e3)

        noise
        noise rejection method ('car' for common average 'nn' for nearest neighbor, or 'none',
        default: 'none')

        freq_range
        vector with two elements to specify the frequency range (one element specifies low pass, default: 300)

        savedir
        directory to store results (default: pwd)

        hist_min_f
        lowermost frequency to display for contour histogram (default: 1e3)

        hist_max_f
        uppermost frequency to display for contour histogram (default: 10e3)

        lfp_min_f
        lowermost frequency to display for contour histogram (default: 1)

        lfp_max_f
        uppermost frequency to display for contour histogram (default: 100)

        scale
        scale for LFP spectrogram amplitude (linear or log, default: log)

        lfp_colors
        colormap (string) for lfp data (default: jet)

        hist_colors
        colormap(string) for histogram (default: jet)

        medfilt_scale
        timescale for median filter (in ms, leave blank to skip, default: 1.5)

        method
        method for computing the LFP spectrogram ('raw' for single Hanning taper or 'mt' for 
        multi-taper using Slepian functions, default: mt)

        lfp_nfft
        nfft for lfp spectrogram (default: 10e3)

        lfp_n
        window size for lfp spectrogram (default: 6250)

        lfp_overlap
        overlap for lfp spectrogram (default: 6000)

        lfp_w
        bandwidth for multi-taper (default: 2)

        lfp_ntapers
        override default number of tapers (leave blank for default, default: 2*w-1)

        singletrials
        number of single trial spectrograms to plot</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../ephys/helpers/ephys/ephys_condition_signal.html" class="code" title="function EPHYS_DATA=ephys_condition_signal(EPHYS_DATA,DATA_TYPE,varargin)">ephys_condition_signal</a>	</li><li><a href="../ephys/helpers/ephys/ephys_denoise_signal.html" class="code" title="function [DATA,CAR]=ephys_denoise_signal(EPHYS_DATA,CHIN,CHOUT,varargin)">ephys_denoise_signal</a>	</li><li><a href="../ephys/helpers/visualization/multi_fig_save.html" class="code" title="function multi_fig_save(fighandle,save_dir,filename,formats,varargin)">multi_fig_save</a>	</li><li><a href="../ephys/helpers/visualization/time_frequency_raster.html" class="code" title="function fig_num=time_frequency_raster(HISTOGRAM,TFIMAGE,varargin)">time_frequency_raster</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../ephys/pipeline/ephys_pipeline_lfp_standalone.html" class="code" title="function ephys_lfp_standalone(PROCDIR,CONFIG)">ephys_pipeline_lfp_standalone</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function parsave(FILE,t,f,spect)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [SPECT_AVE]=ephys_visual_lfp_tf(EPHYS_DATA,HISTOGRAM,CHANNELS,varargin)</a>
0002 <span class="comment">%ephys_lfp_tf.m takes data generated by ephys_cluster.m and stored in extracted_data.mat</span>
0003 <span class="comment">%and produces song_aligned LFP average spectrogram</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%    [LFP_RASTER TIME LABEL HISTOGRAM]=ephys_lfp_amp(MIC_DATA,EPHYS_DATA,CHANNELS,varargin)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%    EPHYS_DATA</span>
0008 <span class="comment">%    aligned ephys data generated by ephys_cluster or in extracted_data/aggregated_data.mat</span>
0009 <span class="comment">%    (should be the variable ephys_data), the data should be a matrix of doubles that is</span>
0010 <span class="comment">%    samples x trials x channels</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%    HISTOGRAM</span>
0013 <span class="comment">%    contour histogram returned by ephys_visual_histogram.m (or loaded from histogram.mat)</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%    CHANNELS</span>
0016 <span class="comment">%    channel labels (i.e. the channel that corresponds to a given element in the cell array</span>
0017 <span class="comment">%    ephys_data) from ephys_cluster.m or extracted_data/aggregated_data.mat</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%    the following may be specified as parameter/value pairs:</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%        car_exclude</span>
0022 <span class="comment">%        electrodes to exclude from noise estimate</span>
0023 <span class="comment">%</span>
0024 <span class="comment">%        SR</span>
0025 <span class="comment">%        data sampling rate (default: 25e3)</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%        noise</span>
0028 <span class="comment">%        noise rejection method ('car' for common average 'nn' for nearest neighbor, or 'none',</span>
0029 <span class="comment">%        default: 'none')</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%        freq_range</span>
0032 <span class="comment">%        vector with two elements to specify the frequency range (one element specifies low pass, default: 300)</span>
0033 <span class="comment">%</span>
0034 <span class="comment">%        savedir</span>
0035 <span class="comment">%        directory to store results (default: pwd)</span>
0036 <span class="comment">%</span>
0037 <span class="comment">%        hist_min_f</span>
0038 <span class="comment">%        lowermost frequency to display for contour histogram (default: 1e3)</span>
0039 <span class="comment">%</span>
0040 <span class="comment">%        hist_max_f</span>
0041 <span class="comment">%        uppermost frequency to display for contour histogram (default: 10e3)</span>
0042 <span class="comment">%</span>
0043 <span class="comment">%        lfp_min_f</span>
0044 <span class="comment">%        lowermost frequency to display for contour histogram (default: 1)</span>
0045 <span class="comment">%</span>
0046 <span class="comment">%        lfp_max_f</span>
0047 <span class="comment">%        uppermost frequency to display for contour histogram (default: 100)</span>
0048 <span class="comment">%</span>
0049 <span class="comment">%        scale</span>
0050 <span class="comment">%        scale for LFP spectrogram amplitude (linear or log, default: log)</span>
0051 <span class="comment">%</span>
0052 <span class="comment">%        lfp_colors</span>
0053 <span class="comment">%        colormap (string) for lfp data (default: jet)</span>
0054 <span class="comment">%</span>
0055 <span class="comment">%        hist_colors</span>
0056 <span class="comment">%        colormap(string) for histogram (default: jet)</span>
0057 <span class="comment">%</span>
0058 <span class="comment">%        medfilt_scale</span>
0059 <span class="comment">%        timescale for median filter (in ms, leave blank to skip, default: 1.5)</span>
0060 <span class="comment">%</span>
0061 <span class="comment">%        method</span>
0062 <span class="comment">%        method for computing the LFP spectrogram ('raw' for single Hanning taper or 'mt' for</span>
0063 <span class="comment">%        multi-taper using Slepian functions, default: mt)</span>
0064 <span class="comment">%</span>
0065 <span class="comment">%        lfp_nfft</span>
0066 <span class="comment">%        nfft for lfp spectrogram (default: 10e3)</span>
0067 <span class="comment">%</span>
0068 <span class="comment">%        lfp_n</span>
0069 <span class="comment">%        window size for lfp spectrogram (default: 6250)</span>
0070 <span class="comment">%</span>
0071 <span class="comment">%        lfp_overlap</span>
0072 <span class="comment">%        overlap for lfp spectrogram (default: 6000)</span>
0073 <span class="comment">%</span>
0074 <span class="comment">%        lfp_w</span>
0075 <span class="comment">%        bandwidth for multi-taper (default: 2)</span>
0076 <span class="comment">%</span>
0077 <span class="comment">%        lfp_ntapers</span>
0078 <span class="comment">%        override default number of tapers (leave blank for default, default: 2*w-1)</span>
0079 <span class="comment">%</span>
0080 <span class="comment">%        singletrials</span>
0081 <span class="comment">%        number of single trial spectrograms to plot</span>
0082 <span class="comment">%</span>
0083 <span class="comment">%</span>
0084 
0085 <span class="keyword">if</span> nargin&lt;2 | isempty(CHANNELS), CHANNELS=1:16; <span class="keyword">end</span>
0086 
0087 nparams=length(varargin);
0088 
0089 <span class="keyword">if</span> mod(nparams,2)&gt;0
0090     error(<span class="string">'Parameters must be specified as parameter/value pairs'</span>);
0091 <span class="keyword">end</span>
0092 
0093 <span class="comment">%%%</span>
0094 
0095 SR=25e3;
0096 noise=<span class="string">'none'</span>; <span class="comment">% common-average reference for noise removal</span>
0097 car_exclude=[];
0098 savedir=pwd;
0099 hist_colors=<span class="string">'jet'</span>;
0100 lfp_colors=<span class="string">'jet'</span>;
0101 lfp_min_f=1; <span class="comment">% bring down to 1</span>
0102 lfp_max_f=100;
0103 lfp_n=6250;
0104 lfp_overlap=6000;
0105 lfp_nfft=10000; <span class="comment">% we want bins on the order</span>
0106 lfp_w=2; <span class="comment">% time bandwidth product if using multi-taper</span>
0107 lfp_ntapers=[]; <span class="comment">% number of tapers, leave blank to use 2*nw-1</span>
0108 
0109 hist_min_f=1e3;
0110 hist_max_f=10e3;
0111 
0112 figtitle=[];
0113 freq_range=[300]; <span class="comment">% frequency range for filtering</span>
0114 channels=CHANNELS;
0115 method=<span class="string">'mt'</span>; <span class="comment">% raw or mt for multi-taper</span>
0116 scale=<span class="string">'log'</span>;
0117 scalelabel=<span class="string">'dB'</span>;
0118 singletrials=5;
0119 medfilt_scale=1.5; <span class="comment">% median filter scale (in ms)</span>
0120 
0121 <span class="keyword">for</span> i=1:2:nparams
0122     <span class="keyword">switch</span> lower(varargin{i})
0123         <span class="keyword">case</span> <span class="string">'sr'</span>
0124             SR=varargin{i+1};
0125         <span class="keyword">case</span> <span class="string">'savedir'</span>
0126             savedir=varargin{i+1};
0127         <span class="keyword">case</span> <span class="string">'hist_colors'</span>
0128             hist_colors=varargin{i+1};
0129         <span class="keyword">case</span> <span class="string">'car_exclude'</span>
0130             car_exclude=varargin{i+1};
0131         <span class="keyword">case</span> <span class="string">'figtitle'</span>
0132             figtitle=varargin{i+1};
0133         <span class="keyword">case</span> <span class="string">'freq_range'</span>
0134             freq_range=varargin{i+1};
0135         <span class="keyword">case</span> <span class="string">'channels'</span>
0136             channels=varargin{i+1};
0137         <span class="keyword">case</span> <span class="string">'method'</span>
0138             method=varargin{i+1};
0139         <span class="keyword">case</span> <span class="string">'noise'</span>
0140             noise=varargin{i+1};
0141         <span class="keyword">case</span> <span class="string">'lfp_ntapers'</span>
0142             lfp_ntapers=varargin{i+1};
0143         <span class="keyword">case</span> <span class="string">'lfp_w'</span>
0144             lfp_w=varargin{i+1};
0145         <span class="keyword">case</span> <span class="string">'scale'</span>
0146             scale=varargin{i+1};
0147         <span class="keyword">case</span> <span class="string">'singletrials'</span>
0148             singletrials=varargin{i+1};
0149         <span class="keyword">case</span> <span class="string">'lfp_min_f'</span>
0150             lfp_min_f=varargin{i+1};
0151         <span class="keyword">case</span> <span class="string">'lfp_max_f'</span>
0152             lfp_max_f=varargin{i+1};
0153         <span class="keyword">case</span> <span class="string">'lfp_colors'</span>
0154             lfp_colors=varargin{i+1};
0155         <span class="keyword">case</span> <span class="string">'lfn_n'</span>
0156             lfp_n=varargin{i+1};
0157         <span class="keyword">case</span> <span class="string">'lfp_nfft'</span>
0158             lfp_nfft=varargin{i+1};
0159         <span class="keyword">case</span> <span class="string">'lfp_overlap'</span>
0160             lfp_overlap=varargin{i+1};
0161     <span class="keyword">end</span>
0162 <span class="keyword">end</span>
0163 
0164 <span class="comment">% need to write a function for automatically determining which electrodes to reject</span>
0165 
0166 [nsamples,ntrials,nchannels]=size(EPHYS_DATA);
0167 
0168 TIME=[1:nsamples]./SR;
0169 
0170 <span class="comment">% if the window size is greater than the length of the signal</span>
0171 <span class="comment">% make the window size roughly the length of the signal/5</span>
0172 <span class="comment">% and adjust the overlap accordingly</span>
0173 
0174 
0175 <span class="keyword">if</span> lfp_n&gt;nsamples
0176     difference=lfp_n-lfp_overlap;
0177     lfp_n=round(nsamples/5);
0178     lfp_overlap=lfp_n-difference;
0179 
0180     disp(<span class="string">'Reset window size and overlap, longer than nsamples'</span>);
0181     disp([<span class="string">'Window size:  '</span> num2str(lfp_n) <span class="string">' samples'</span>]);
0182     disp([<span class="string">'Overlap:  '</span> num2str(lfp_overlap) <span class="string">' samples'</span>]);
0183 
0184 <span class="keyword">end</span>
0185 
0186 <span class="comment">% if nfft is empty set to nextpow2</span>
0187 
0188 <span class="keyword">if</span> isempty(lfp_nfft)
0189     lfp_nfft=2^nextpow2(lfp_n);
0190 <span class="keyword">end</span>
0191 
0192 
0193 <span class="comment">% check if we're using multi-taper</span>
0194 
0195 <span class="keyword">if</span> lower(method(1))==<span class="string">'m'</span>
0196 
0197     resolution=lfp_w*1/(lfp_n/SR);
0198     
0199     <span class="keyword">if</span> isempty(lfp_ntapers)
0200         lfp_ntapers=2*(lfp_w)-1;
0201     <span class="keyword">end</span>
0202     [tapers,lambda]=dpss(lfp_n,lfp_w,lfp_ntapers);
0203 <span class="keyword">else</span>
0204     lfp_ntapers=<span class="string">''</span>;
0205     resolution=lfp_n/SR;
0206     tapers=[];
0207 <span class="keyword">end</span>
0208 
0209 disp([<span class="string">'Resolution:  '</span> num2str(resolution)  <span class="string">' Hz'</span>]);
0210 disp([<span class="string">'NFFT:  '</span> num2str(lfp_nfft)]);
0211 
0212 
0213 <span class="comment">% get rows and columns</span>
0214 
0215 <span class="keyword">if</span> mod(lfp_nfft,2)==0
0216     rows=(lfp_nfft/2+1);
0217 <span class="keyword">else</span>
0218     rows=(lfp_nfft+1)/2;
0219 <span class="keyword">end</span>
0220 
0221 columns=fix((nsamples-lfp_overlap)/(lfp_n-lfp_overlap));
0222 
0223 f=((1:rows)./rows).*(SR/2);
0224 col_idx=1+(0:(columns-1))*(lfp_n-lfp_overlap);
0225 t=((col_idx-1)+((lfp_n/2)'))/SR;
0226 <span class="comment">%t=(col_idx)/SR;</span>
0227 
0228 lfp_startidx=max([find(f&lt;=lfp_min_f)]);
0229 
0230 <span class="keyword">if</span> isempty(lfp_startidx)
0231     lfp_startidx=1;
0232 <span class="keyword">end</span>
0233 
0234 lfp_stopidx=min([find(f&gt;=lfp_max_f)]);
0235 
0236 <span class="comment">% preallocate matrices</span>
0237 
0238 SPECT_AVE.t=t;
0239 SPECT_AVE.f=f;
0240 SPECT_AVE.image=zeros(length(f),length(t),length(channels),<span class="string">'single'</span>);
0241 
0242 <span class="comment">% denoise and condition the signal</span>
0243 
0244 proc_data=<a href="../ephys/helpers/ephys/ephys_denoise_signal.html" class="code" title="function [DATA,CAR]=ephys_denoise_signal(EPHYS_DATA,CHIN,CHOUT,varargin)">ephys_denoise_signal</a>(EPHYS_DATA,CHANNELS,channels,<span class="string">'method'</span>,noise,<span class="string">'car_exclude'</span>,car_exclude);
0245 clear EPHYS_DATA;
0246 proc_data=double(<a href="../ephys/helpers/ephys/ephys_condition_signal.html" class="code" title="function EPHYS_DATA=ephys_condition_signal(EPHYS_DATA,DATA_TYPE,varargin)">ephys_condition_signal</a>(proc_data,<span class="string">'l'</span>,<span class="string">'freq_range'</span>,freq_range));
0247 
0248 <span class="comment">% create output directory</span>
0249 
0250 [path,name,ext]=fileparts(savedir);
0251 savedir=fullfile(savedir,<span class="string">'lfp_tf'</span>);
0252 
0253 <span class="keyword">if</span> ~exist(savedir,<span class="string">'dir'</span>)
0254     mkdir(fullfile(savedir));
0255 <span class="keyword">end</span>
0256 
0257 <span class="comment">% single trials go in a subdir</span>
0258 
0259 savefilename=[ name <span class="string">'_lfptf_electrode_'</span>];
0260 
0261 delete(fullfile(savedir,[savefilename <span class="string">'*'</span>]));
0262 
0263 <span class="keyword">if</span> exist(fullfile(savedir,<span class="string">'singletrials'</span>));
0264     rmdir(fullfile(savedir,<span class="string">'singletrials'</span>),<span class="string">'s'</span>);
0265 <span class="keyword">end</span>
0266 
0267 <span class="keyword">for</span> i=1:length(channels)
0268 
0269     savedir_st=fullfile(savedir,<span class="string">'singletrials'</span>,[ <span class="string">'ch'</span> num2str(channels(i))]);
0270 
0271     <span class="keyword">if</span> ~exist(savedir_st,<span class="string">'dir'</span>)
0272         mkdir(savedir_st);
0273     <span class="keyword">end</span>
0274     
0275     spect_ave_tmp=zeros(rows,columns);
0276 
0277     parfor j=1:ntrials
0278     
0279         currdata=proc_data(:,j,i);
0280 
0281         <span class="keyword">if</span> lower(method(1))==<span class="string">'r'</span>
0282 
0283             [spect]=spectrogram(currdata,lfp_n,lfp_overlap,lfp_nfft);
0284             spect=abs(spect);
0285 
0286         <span class="keyword">else</span>
0287 
0288             <span class="comment">% average over tapers</span>
0289 
0290             spect=zeros(rows,columns);
0291 
0292             <span class="keyword">for</span> k=1:lfp_ntapers
0293 
0294                 spect_tmp=spectrogram(currdata,tapers(:,k),lfp_overlap,lfp_nfft);
0295                 spect_tmp=abs(spect_tmp);
0296 
0297                 <span class="comment">% reduce instead to save memory</span>
0298 
0299                 spect=spect+spect_tmp./lfp_ntapers;
0300 
0301             <span class="keyword">end</span>
0302 
0303         <span class="keyword">end</span>
0304     
0305         <span class="comment">% reduction to save memory, storing in a large matrix probably not viable for large n...</span>
0306         
0307         spect_ave_tmp=spect_ave_tmp+spect./ntrials;
0308 
0309         <span class="keyword">if</span> j&lt;=singletrials
0310             
0311             singletrialfig=figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>,<span class="string">'position'</span>,[0 0 800 600]);
0312 
0313             <span class="comment">% just plot a simple spectrogram and save</span>
0314 
0315 
0316             <span class="keyword">switch</span> lower(scale)
0317                 <span class="keyword">case</span> <span class="string">'linear'</span>
0318                     imagesc(t,f(lfp_startidx:lfp_stopidx),spect(lfp_startidx:lfp_stopidx,:));
0319                 <span class="keyword">case</span> <span class="string">'log'</span>
0320                     imagesc(t,f(lfp_startidx:lfp_stopidx),20*log10(spect(lfp_startidx:lfp_stopidx,:)));
0321                 <span class="keyword">otherwise</span>
0322                     error(<span class="string">'Did not understand scale, must be log or linear!'</span>);
0323             <span class="keyword">end</span>
0324 
0325             set(gca,<span class="string">'ydir'</span>,<span class="string">'normal'</span>);
0326 
0327             axis tight;
0328             colormap(lfp_colors);
0329             set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'ytick'</span>,[round(lfp_min_f/10):1:round(lfp_max_f/10)]*10,<span class="keyword">...</span>
0330                 <span class="string">'linewidth'</span>,1.5,<span class="string">'ticklength'</span>,[.025 .025],<span class="string">'FontSize'</span>,16,<span class="string">'FontName'</span>,<span class="string">'Helvetica'</span>);
0331             xlabel(<span class="string">'Time (in s)'</span>,<span class="string">'FontSize'</span>,13,<span class="string">'FontName'</span>,<span class="string">'Helvetica'</span>);
0332             ylabel(<span class="string">'Hz'</span>,<span class="string">'FontSize'</span>,13,<span class="string">'FontName'</span>,<span class="string">'Helvetica'</span>);
0333             box off;
0334             set(singletrialfig,<span class="string">'PaperPositionMode'</span>,<span class="string">'auto'</span>)
0335             <a href="../ephys/helpers/visualization/multi_fig_save.html" class="code" title="function multi_fig_save(fighandle,save_dir,filename,formats,varargin)">multi_fig_save</a>(singletrialfig,savedir_st,[<span class="string">'trial'</span> num2str(j)],<span class="string">'eps,png'</span>);
0336             close([singletrialfig]);
0337 
0338             <a href="#_sub1" class="code" title="subfunction parsave(FILE,t,f,spect)">parsave</a>(fullfile(savedir_st,[ <span class="string">'trial'</span> num2str(j)]),t,f,spect);
0339 
0340         <span class="keyword">end</span>
0341         
0342     <span class="keyword">end</span>
0343 
0344     SPECT_AVE.image(:,:,i)=single(spect_ave_tmp); <span class="comment">% for saving</span>
0345     spect_ave_plot.image=spect_ave_tmp./max(max(spect_ave_tmp)); <span class="comment">% normalize so max is 0 db</span>
0346     spect_ave_plot.t=SPECT_AVE.t;
0347     spect_ave_plot.f=SPECT_AVE.f;
0348 
0349     spect_fig=figure(<span class="string">'visible'</span>,<span class="string">'off'</span>,<span class="string">'Units'</span>,<span class="string">'Pixels'</span>,<span class="string">'Position'</span>,[0 0 round(600*nsamples/SR) 800]);
0350     
0351     fig_title=[<span class="string">'CH'</span> num2str(channels(i)) <span class="string">' NTAP'</span> num2str(lfp_ntapers) <span class="string">' RES '</span> num2str(resolution) <span class="string">' Hz'</span> <span class="string">' NTRIALS'</span> num2str(ntrials)];
0352 
0353     spect_fig=<a href="../ephys/helpers/visualization/time_frequency_raster.html" class="code" title="function fig_num=time_frequency_raster(HISTOGRAM,TFIMAGE,varargin)">time_frequency_raster</a>(HISTOGRAM,spect_ave_plot,<span class="string">'fig_num'</span>,spect_fig,<span class="string">'fig_title'</span>,fig_title,<span class="string">'scale'</span>,scale,<span class="keyword">...</span>
0354         <span class="string">'scalelabel'</span>,scalelabel,<span class="string">'hist_min_f'</span>,hist_min_f,<span class="string">'hist_max_f'</span>,hist_max_f,<span class="string">'tf_min_f'</span>,lfp_min_f,<span class="string">'tf_max_f'</span>,lfp_max_f);
0355 
0356     set(spect_fig,<span class="string">'PaperPositionMode'</span>,<span class="string">'auto'</span>);
0357 
0358     <a href="../ephys/helpers/visualization/multi_fig_save.html" class="code" title="function multi_fig_save(fighandle,save_dir,filename,formats,varargin)">multi_fig_save</a>(spect_fig,savedir,<span class="keyword">...</span>
0359         [ savefilename num2str(channels(i)) ],<span class="string">'eps,png'</span>);
0360     close([spect_fig]);
0361 
0362 <span class="keyword">end</span>
0363 
0364 save(fullfile(savedir,<span class="string">'lfp_tf_data.mat'</span>),<span class="string">'CHANNELS'</span>,<span class="string">'channels'</span>,<span class="string">'SPECT_AVE'</span>);
0365 
0366 <span class="keyword">end</span>
0367 
0368 <a name="_sub1" href="#_subfunctions" class="code">function parsave(FILE,t,f,spect)</a>
0369     
0370 save(FILE,<span class="string">'t'</span>,<span class="string">'f'</span>,<span class="string">'spect'</span>);
0371 
0372 <span class="keyword">end</span>
0373 
0374</pre></div>
<hr><address>Generated on Thu 19-Jul-2012 21:29:37 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>