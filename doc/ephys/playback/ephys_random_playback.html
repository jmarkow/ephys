<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ephys_random_playback</title>
  <meta name="keywords" content="ephys_random_playback">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../menu.html">Home</a> &gt;  <a href="../menu.html">ephys</a> &gt; <a href="menu.html">playback</a> &gt; ephys_random_playback.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../menu.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="menu.html">Index for ephys/playback&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>ephys_random_playback
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function ephys_random_playback(SND,RNDSND,FS,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function cleanup_routine(obj,event,logfile,trialfile)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function ephys_random_playback(SND,RNDSND,FS,varargin)</a>
0002 <span class="comment">%</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%</span>
0006 
0007 <span class="comment">% RNDSND MUST BE A CELL ARRAY</span>
0008 
0009 <span class="keyword">if</span> ~iscell(RNDSND), error(<span class="string">'Random sounds must be stored in a cell array!'</span>), <span class="keyword">end</span>;
0010 
0011 nparams=length(varargin);
0012 
0013 
0014 <span class="keyword">if</span> mod(nparams,2)&gt;0
0015     error(<span class="string">'Parameters must be specified as parameter/value pairs!'</span>);
0016 <span class="keyword">end</span>
0017 
0018 start_time=now;
0019 time_init=datestr(start_time,0);
0020 filename=datestr(start_time,30);
0021 logfile=[ filename <span class="string">'.log'</span> ];
0022 trialfile=[ filename <span class="string">'_trials.log'</span> ];
0023 interval=10; <span class="comment">% sound interval in seconds</span>
0024 chance=.1; <span class="comment">% chance that any of the SND2 stimuli will be played</span>
0025        <span class="comment">% will be divided by nstimuli for multiple stimuli</span>
0026 
0027 <span class="keyword">for</span> i=1:2:nparams
0028     <span class="keyword">switch</span> lower(varargin{i})
0029         <span class="keyword">case</span> <span class="string">'logfile'</span>
0030             logfile=varargin{i+1};
0031         <span class="keyword">case</span> <span class="string">'interval'</span>
0032             interval=varargin{i+1};
0033         <span class="keyword">case</span> <span class="string">'start_time'</span>
0034             start_time=varargin{i+1};
0035         <span class="keyword">case</span> <span class="string">'chance'</span>
0036             chance=varargin{i+1};
0037         <span class="keyword">otherwise</span>
0038     <span class="keyword">end</span>
0039 <span class="keyword">end</span>
0040 
0041 <span class="comment">% few things:</span>
0042 <span class="comment">% write out to log for each stimulation, copy down time and volume</span>
0043 <span class="comment">%</span>
0044 <span class="comment">% that should be it, leave the rest to alignment with the recording software!</span>
0045 
0046 <span class="comment">% calibration to 70 db spl</span>
0047 
0048 <span class="comment">% bird habituates after 50-250 playbacks</span>
0049 
0050 logfile_id=fopen(logfile,<span class="string">'w'</span>);
0051 trialfile_id=fopen(trialfile,<span class="string">'w'</span>);
0052 
0053 fprintf(logfile_id,<span class="string">'Run initiated at:\t%s\n\n'</span>,time_init);
0054 fprintf(logfile_id,<span class="string">'Parameters:\nInterval:\t%g\nRandom phase start:\t%s\nN stimuli:\t%g\nChance:\t%g\n'</span>,<span class="keyword">...</span>
0055     interval,datestr(start_time),length(RNDSND),chance);
0056 
0057 <span class="comment">% let's start with 10s intervals</span>
0058 
0059 disp(<span class="string">'Ready to begin calibration...'</span>);
0060 
0061 response=[];
0062 
0063 <span class="comment">% routine to close the logfile when we quit</span>
0064 
0065 cleanup_object=onCleanup(@()<a href="#_sub1" class="code" title="subfunction cleanup_routine(obj,event,logfile,trialfile)">cleanup_routine</a>([],[],logfile_id,trialfile_id));
0066 
0067 disp(<span class="string">'Will play loaded sound, press enter to continue...'</span>);
0068 pause();
0069 sound(SND,FS);
0070 
0071 <span class="keyword">while</span> isempty(response)
0072         
0073     response=input(<span class="string">'Was the sound level 70 db (y or n)?  '</span>,<span class="string">'s'</span>);
0074     
0075     <span class="keyword">if</span> isempty(response), <span class="keyword">continue</span>; <span class="keyword">end</span>
0076     
0077     <span class="keyword">switch</span> lower(response(1))
0078 
0079         <span class="keyword">case</span> <span class="string">'y'</span>
0080             disp(<span class="string">'Continuing with the playback!'</span>);
0081         <span class="keyword">case</span> <span class="string">'n'</span>
0082             disp(<span class="string">'Retrying...'</span>);
0083             disp(<span class="string">'Will play loaded sound, press enter to continue...'</span>);
0084             pause();
0085             sound(SND,FS);
0086             response=[];
0087         <span class="keyword">otherwise</span>
0088             response=[];
0089 
0090     <span class="keyword">end</span>
0091 
0092 <span class="keyword">end</span>
0093 
0094 disp([<span class="string">'Sound length '</span> num2str(length(SND)/FS) <span class="string">' seconds'</span>]);
0095 disp([<span class="string">'Interval between playbacks '</span> num2str(interval) <span class="string">' seconds'</span>]);
0096 
0097 p_chance=ones(1,length(RNDSND)).*(1/length(RNDSND));
0098 chance_bin_edges=[0 cumsum(p_chance)];
0099 chance_bin_edges(end)=inf;
0100 
0101 rand_phase_flag=0;
0102 
0103 <span class="keyword">while</span> 1
0104 
0105     <span class="comment">% get the timestamp, play the sound, and pause</span>
0106 
0107     curr_time=now;
0108     timestamp=datestr(curr_time,0);
0109 
0110     <span class="comment">% if it's later than the rand start time enter the random phase</span>
0111 
0112     <span class="keyword">if</span> curr_time&gt;start_time
0113 
0114         <span class="comment">% start the random condition</span>
0115         <span class="comment">% rand_selection</span>
0116 
0117         <span class="keyword">if</span> ~rand_phase_flag
0118             disp([<span class="string">'Entering random phase at '</span> timestamp]);
0119             fprintf(logfile_id,<span class="string">'Entered random phase at %s\n'</span>,timestamp);
0120             rand_phase_flag=1;
0121         <span class="keyword">end</span>
0122     
0123         <span class="comment">% if rand&lt;p(rand) then initiate rand sound</span>
0124 
0125         <span class="keyword">if</span> rand(1)&lt;chance
0126         
0127             <span class="comment">% bin a random number to the make the choice (divided evenly between nstimuli)</span>
0128 
0129             n=histc(rand(1),chance_bin_edges);
0130             choice=find(n);
0131 
0132             <span class="comment">% choose the stimulus and mark it</span>
0133 
0134             stimulus=RNDSND{choice};
0135             disp([<span class="string">'Random playback stimulus '</span> num2str(choice) <span class="string">' at '</span> timestamp ]);
0136             fprintf(logfile_id,<span class="string">'Random playback event sound %g at %s\n'</span>,choice,timestamp);
0137             fprintf(trialfile_id,<span class="string">'%i\n'</span>,choice);
0138         
0139         <span class="keyword">else</span>
0140             <span class="comment">% otherwise standard playback</span>
0141 
0142             disp([<span class="string">'Standard playback at '</span> timestamp ]);
0143             fprintf(logfile_id,<span class="string">'Standard playback event at %s\n'</span>,timestamp);
0144             fprintf(trialfile_id,<span class="string">'%i\n'</span>,0);
0145             stimulus=SND;
0146         
0147         <span class="keyword">end</span>    
0148 
0149     <span class="keyword">else</span>
0150         <span class="comment">% standard playback</span>
0151 
0152         disp([<span class="string">'Standard playback at '</span> timestamp ]);
0153         fprintf(logfile_id,<span class="string">'Standard playback event at %s\n'</span>,timestamp);
0154         fprintf(trialfile_id,<span class="string">'%i\n'</span>,0);
0155         stimulus=SND;
0156     <span class="keyword">end</span>
0157 
0158     sound(stimulus,FS);    
0159     pause(interval);
0160 
0161 <span class="keyword">end</span>
0162 
0163 fclose(logfile_id);
0164 fclose(trialfile_id);
0165 
0166 <span class="keyword">end</span>
0167 
0168 <a name="_sub1" href="#_subfunctions" class="code">function cleanup_routine(obj,event,logfile,trialfile)</a>
0169 
0170 timestamp=datestr(now,0);
0171 
0172 disp([<span class="string">'Stopped playback at '</span> timestamp ]);
0173 
0174 fprintf(logfile,<span class="string">'\nStopped playback at %s'</span>,timestamp);
0175 fclose(logfile);
0176 fclose(trialfile);
0177 
0178 <span class="keyword">end</span>
0179 
0180 
0181 <span class="comment">%</span>
0182 <span class="comment">%</span>
0183</pre></div>
<hr><address>Generated on Thu 19-Jul-2012 09:35:15 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>